---
apiVersion: "v1"
kind: "ConfigMap"
metadata:
  name: {{ print (include "bitcoin-core.name" .) "-entrypoint" | quote }}
  labels: {{- include "bitcoin-core.labels" . | nindent 4 }}
data:
  entrypoint: |
    #!/bin/ash
    set -ex
    exec su-exec bitcoin bitcoind -datadir="$BITCOIN_DATA"

---
apiVersion: "v1"
kind: "ConfigMap"
metadata:
  name: {{ print (include "bitcoin-core.name" .) "-bitcoind" | quote }}
  labels: {{- include "bitcoin-core.labels" . | nindent 4 }}
data:
  bitcoin.conf: |
    printtoconsole=1
    server=1
    bind={{ .Values.bitcoind.p2p.bind }}
    rpcbind={{ .Values.bitcoind.rpc.bind }}
    rpcallowip={{ .Values.bitcoind.rpc.allowip }}
    rpcport={{ .Values.bitcoind.rpc.port }}
    rpcuser={{ .Values.bitcoind.rpc.username }}
    rpcpassword={{ .Values.bitcoind.rpc.password }}
    {{- with .Values.bitcoind.additionalOptions }}
    {{- . | nindent 4 }}
    {{- end }}
